# 크라임씬: 온라인 추리 세션 허브

## 프로젝트 개요
- **형태**: 정적 웹 기반 멀티플레이 추리 게임 운영 콘솔 & 플레이어 포털
- **구성**: 랜딩(소개) · 호스트 콘솔 · 플레이어 전용 페이지로 분리된 3가지 HTML 진입점
- **주요 특징**: 시나리오 선택, 세션 생성, 자동 랜덤 역할 배정, 봇 인원 보충, 실시간 채팅이 모두 프론트엔드와 RESTful Table API만으로 구현
- **기술 스택**: HTML5, CSS3, 모듈형 JavaScript(ES Modules), Table API (`sessions`, `players`, `chat_messages`)

## 구현 완료 기능
1. **멀티 페이지 허브**
   - `index.html`에서 전체 컨셉, 사건 세트 카드, 역할 배정 흐름을 소개하고 호스트·플레이어 페이지로 이동 가능
2. **사건 세트 카탈로그**
   - 자정의 커튼콜 / 겨울 산장의 봉인 / 서울 사이버 포렌식 3종 시나리오 내장
   - 난이도, 진행 시간, 분위기, 최소/최대 인원, 타임라인·증거·질문 가이드 등 세부 정보 자동 렌더링
3. **호스트 콘솔 (`host.html`)**
   - 세션 코드 생성(자동/커스텀), 단계 추적, 토스트 안내, 실시간 진행 메타 표시
   - 플레이어 추가/초기화, 봇 자동 추가, 인원 통계 표시, 최소 인원 충족 시 랜덤 역할 자동 배정
   - 시나리오 변경 시 기존 역할을 초기화하고 새 시나리오 기준으로 재배정
   - 채팅 감독 및 플레이어 입장 링크 클립보드 복사 지원
   - 진행 중 언제든 **게임 중단** 버튼으로 결과 화면으로 이동시키고 세션 상태를 `closed`로 마감
   - 기존에 생성되어 진행 중이던 세션도 페이지를 새로고침(또는 재방문)하면 동일하게 중단 버튼을 사용할 수 있음
4. **플레이어 포털 (`player.html`)**
   - 참가자가 직접 닉네임·PIN을 입력해 즉시 레코드를 생성하고, 동일 PIN으로 재접속 지원
   - 개인 역할 브리핑 / 진실 단서 / 혼선 단서 / 범인에게 노출될 단서를 카드형으로 분리 표시
   - 세션 단계, 잔여 타이머, 사건 요약을 실시간 동기화하고 투표 시점에는 후보 목록과 투표 진행률을 자동 구성
- 채팅은 3초, 세션·플레이어·로스터는 4~6초 주기로 갱신해 모바일에서도 안정적으로 유지
5. **자동 단계 타이머 & 최후 투표 흐름**
   - 브리핑(5분) → 1차 단서 공개(6분) → 1차 토론(8분) → 2차 단서 공개(6분) → 2차 토론(8분) → 3차 단서 공개(6분) → 최종 토론(9분) → 최후 투표(3분) 순으로 타이머 만료 시 자동 전환
   - 투표 종료 시 호스트 개입 없이 Table API에 투표 수를 집계하고 승패·득표 요약을 `sessions.vote_summary`에 저장
- 플레이어 포털은 투표 진행률과 최종 결과 배너(득표수·승리 팀)를 동일하게 공유
- 단서는 브리핑 이후 단계별로 잠금 해제되며, 1·2·3차 단서 라운드마다 최소 2개 이상의 단서/분석 포인트가 자동 제공되어 순차 추리를 지원
6. **자동 랜덤 역할 & 봇 보충 로직**
   - 최소 인원 충족 시 탐정/범인/용의자를 시나리오 정의에 맞춰 랜덤 할당
   - 인원이 부족할 경우 봇(BOT-01 등) 추가 가능, 봇은 PIN 없이 활성화되고 자동으로 역할을 부여받음
7. **UX & 반응형 최적화**
   - 공통 토스트, 버튼 상태 제어, 모바일 친화형 네비게이션, 카드형 레이아웃, 플레이어 전용 간결화된 채팅 보드

## 주요 진입 경로 및 URI 요약
| 구분 | 경로 | 설명 |
|------|------|------|
| 랜딩 허브 | `index.html` | 프로젝트 소개, 사건 카드, 빠른 링크 제공 |
| 호스트 콘솔 | `host.html` | 시나리오 선택, 세션 생성, 단계 추적, 플레이어/봇 관리, 채팅 감독 |
| 플레이어 포털 | `player.html` | 닉네임·PIN 등록/재접속, 역할·단서 열람, 단계/타이머 확인, 최후 투표 제출, 채팅 참여 |

## 플레이 흐름 개요
1. 호스트가 `host.html`에서 시나리오를 선택하고 세션을 생성한다. 생성 즉시 자동 단계 타이머와 메타 정보가 초기화된다.
2. 참가자는 `player.html`에서 세션 코드·닉네임·PIN을 입력해 직접 등록하거나, 저장된 PIN으로 재접속한다.
3. 인원 부족 시 호스트는 봇을 추가해 최소 인원을 맞춘 뒤 **게임 시작**을 누르면 즉시 탐정/범인/용의자 역할이 랜덤 배정된다.
4. 브리핑 → 1차 단서 공개 → 1차 토론 → 2차 단서 공개 → 2차 토론 → 3차 단서 공개 → 최종 토론 순으로 타이머 기반으로 자동 진행되며, 각 단서 라운드가 열릴 때마다 해당 단계 전용 단서가 2개 이상 제공된다.
5. 투표 단계 진입 시 플레이어는 후보를 선택해 투표하고, 타이머 종료와 함께 자동으로 승패가 계산되어 결과 배너가 노출된다.
6. 진행 도중 호스트는 언제든 **게임 중단** 버튼을 눌러 세션을 즉시 종료할 수 있으며, 모든 플레이어 화면이 결과 단계로 동기화된다.

## 봇 및 인원 로직
- 각 시나리오는 `playerRange.min/max`를 정의하여 권장 인원을 제시한다.
- 실제 플레이어는 세션 코드만으로 닉네임·PIN을 직접 등록하며, 동일 PIN으로 세션 종료 전까지 자유롭게 재접속 가능하다.
- 봇은 PIN 입력 없이 추가되며, Table API에 `is_bot=true`로 저장되어 플레이어 포털에서는 노출되지 않는다.
- 시나리오 변경 시 기존 역할/단서는 초기화되어 새 시나리오 기준으로 자동 재배정된다.

## 미구현/향후 고려 기능
- 시나리오 CRUD 관리자 도구 (현재는 하드코딩된 3종셋)
- WebSocket 기반 실시간 채팅 전환 및 타yping 인디케이터
- 세션 재개 기능(기존 코드로 데이터 로딩) 및 호스트 대시보드
- 채팅/플레이 데이터 다운로드 혹은 통계 리포트
- PIN 외 인증 보강(예: 일회용 링크, SNS 공유 등)
- 단계 타이머 커스터마이즈, 일시정지 및 재개 컨트롤 제공

## 추천 다음 단계
1. **세션 불러오기 플로우**: 기존 세션 코드를 입력해 진행 현황·플레이어·채팅을 복원
2. **봇 행동 스크립트**: 봇이 자동 메시지나 단서를 던지는 간단한 로직 추가
3. **알림 시스템**: 단계 변경·역할 확정 시 참가자에게 시각/청각 알림 제공
4. **시나리오 확장 툴**: Table API 기반 시나리오 작성/배포 인터페이스 구현
5. **단계 타이머 커스터마이즈**: 각 단계 시간 및 자동 전환 여부를 호스트가 직접 조정할 수 있는 UI 추가

## 퍼블릭 URL 안내
- 배포: **Publish 탭**에서 원클릭 게시 가능 (이 문서에서는 URL 미제공)
- REST Table API 엔드포인트(상대 경로):
  - `GET/POST/PATCH tables/sessions`
  - `GET/POST/PATCH/DELETE tables/players`
  - `GET/POST tables/chat_messages`

## 데이터 모델 & 스토리지
| 테이블 | 주요 필드 | 설명 |
|--------|-----------|------|
| `sessions` | `code`, `host_name`, `scenario_id`, `stage`, `status`, `player_count`, `last_activity`, `stage_started_at`, `stage_deadline_at`, `auto_stage_enabled`, `vote_summary` | 세션 메타데이터, 자동 단계 타이머, 최종 득표 요약 |
| `players` | `session_code`, `name`, `role`, `character`, `pin`, `clue_summary`, `last_seen`, `vote_target`, `has_voted`, `is_bot` | 참가자(봇 포함) 정보, 개인 단서, 하트비트 및 투표 상태 |
| `chat_messages` | `session_code`, `player_name`, `role`, `message`, `sent_at` | 세션별 채팅 로그 |

> ⚠️ **데이터 유지 관리**: 세션 종료 후 `players`와 `chat_messages` 레코드를 삭제하여 PIN/대화 데이터를 정리하는 것을 권장합니다.

## 로컬/개발 환경 가이드
- 정적 사이트이므로 브라우저에서 세 HTML 파일을 직접 열어 테스트 가능
- 주요 스크립트 분리: `js/data.js`(시나리오/스테이지 상수), `js/api.js`(Table API 래퍼), `js/landing.js`, `js/host.js`, `js/player.js`
- 스타일은 `css/style.css` 단일 파일로 관리하며, 공통 컴포넌트 클래스와 페이지 특화 클래스를 포함

## 배포 안내
프로젝트를 라이브로 공개하려면 상단 **Publish** 탭을 이용하세요. 배포 후 자동으로 라이브 URL이 생성되며 Table API 엔드포인트는 동일하게 사용할 수 있습니다.
