<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>크라임씬 호스트 콘솔</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-shell host-app">
        <header class="app-header">
            <a class="brand" href="index.html">크라임씬</a>
            <nav class="app-header__actions">
                <a href="player.html" class="nav-link">플레이어 포털 바로가기</a>
            </nav>
        </header>

        <main class="app-main">
            <section id="setupView" class="app-view app-view--active" aria-labelledby="setupTitle">
                <div class="panel panel--split">
                    <div class="panel__side">
                        <h2 id="setupTitle" class="panel__title">사건 세트 선택</h2>
                        <p class="panel__description">진행할 사건 세트를 선택하고 세션을 생성하세요. 생성 즉시 호스트 역시 플레이어로 대기실에 합류합니다.</p>
                        <label class="field">
                            <span class="field__label">사건 세트</span>
                            <select id="scenarioSelect" class="field__select"></select>
                        </label>
                        <div class="scenario-meta">
                            <span class="badge" id="scenarioDifficulty">난이도</span>
                            <span class="badge badge--tone" id="scenarioTone">톤</span>
                            <span class="badge badge--duration" id="scenarioDuration">예상 진행</span>
                            <span class="badge badge--players" id="scenarioPlayersRange">필수 인원</span>
                        </div>
                        <article class="scenario-card" id="setupScenarioCard">
                            <header class="scenario-card__header">
                                <h3 id="scenarioTitle">사건 제목</h3>
                                <p id="scenarioTagline" class="scenario-card__tagline">요약 문구</p>
                            </header>
                            <div class="scenario-card__grid">
                                <div>
                                    <h4>개요</h4>
                                    <p id="scenarioSummary"></p>
                                    <h4>사건 배경</h4>
                                    <ul id="scenarioMotifs" class="list-bullet"></ul>
                                </div>
                                <div>
                                    <h4>핵심 갈등</h4>
                                    <ul id="scenarioConflicts" class="list-number"></ul>
                                    <h4>추천 플레이 인원</h4>
                                    <p id="scenarioPlayers" class="text-high"></p>
                                </div>
                            </div>
                            <div class="scenario-card__grid scenario-card__grid--compact">
                                <div>
                                    <h4>타임라인</h4>
                                    <ul class="timeline" id="scenarioTimeline"></ul>
                                </div>
                                <div>
                                    <h4>주요 증거</h4>
                                    <div class="evidence-grid">
                                        <div>
                                            <h5>물적 증거</h5>
                                            <ul id="evidencePhysical" class="list-bullet"></ul>
                                        </div>
                                        <div>
                                            <h5>디지털 & 기타</h5>
                                            <ul id="evidenceDigital" class="list-bullet"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4>질문 가이드</h4>
                                    <ul id="investigationPrompts" class="list-number"></ul>
                                </div>
                                <div>
                                    <h4>주요 등장인물</h4>
                                    <div class="suspect-roster" id="suspectRoster"></div>
                                </div>
                            </div>
                        </article>
                    </div>
                    <div class="panel__side panel__side--narrow">
                        <article class="card">
                            <h3 class="card__title">세션 생성</h3>
                            <p class="helper-text">호스트도 플레이어로서 자동 등록되며, 생성 후 즉시 대기실로 이동합니다.</p>
                            <form id="createSessionForm" class="form">
                                <label class="field">
                                    <span class="field__label">호스트 이름</span>
                                    <input type="text" id="hostName" name="hostName" class="field__input" placeholder="예: 지휘관" required>
                                </label>
                                <label class="field">
                                    <span class="field__label">커스텀 세션 코드 (선택)</span>
                                    <input type="text" id="customSessionCode" name="customSessionCode" class="field__input" maxlength="12" placeholder="영문+숫자 조합">
                                </label>
                                <button type="submit" class="btn btn--primary">세션 생성</button>
                            </form>
                            <div class="session-result" id="sessionResult" aria-live="polite"></div>
                        </article>
                        <article class="card" id="hostResumeSection" hidden>
                            <h3 class="card__title">진행 중인 세션</h3>
                            <p class="helper-text">최근 진행한 세션이 아직 종료되지 않았다면 아래에서 곧바로 복귀할 수 있습니다.</p>
                            <div id="hostResumeList" class="list-resume"></div>
                        </article>
                    </div>
                </div>
            </section>

            <section id="lobbyView" class="app-view" aria-labelledby="lobbyTitle">
                <header class="view-header">
                    <div>
                        <h2 id="lobbyTitle" class="view-header__title">대기실</h2>
                        <p class="view-header__subtitle">플레이어를 모집하고 준비를 마친 뒤 게임을 시작하세요. 호스트 역시 플레이어로 참여 중입니다.</p>
                    </div>
                    <div class="view-header__actions">
                        <span class="badge" id="sessionStatusBadge">대기실</span>
                        <button id="startGameBtn" class="btn btn--primary">게임 시작</button>
                    </div>
                </header>
                <div class="panel panel--columns">
                    <div class="panel__column">
                        <article class="card">
                            <h3 class="card__title">세션 메타</h3>
                            <div class="session-meta" id="chatMeta"></div>
                            <div class="stage-tracker__wrapper">
                                <ol class="stage-tracker" id="stageTracker">
                                    <li class="stage-tracker__item stage-tracker__item--active" data-stage="lobby">
                                        <div class="stage-tracker__label">0. 대기실</div>
                                        <p class="stage-tracker__desc">플레이어 모집 및 준비</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="briefing">
                                        <div class="stage-tracker__label">1. 브리핑</div>
                                        <p class="stage-tracker__desc">사건 개요와 역할 브리핑 공유</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="clue_a">
                                        <div class="stage-tracker__label">2. 1차 단서 공개</div>
                                        <p class="stage-tracker__desc">첫 번째 증거를 모두에게 배포</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="discussion_a">
                                        <div class="stage-tracker__label">3. 1차 토론</div>
                                        <p class="stage-tracker__desc">첫 단서를 기반으로 의견 공유</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="clue_b">
                                        <div class="stage-tracker__label">4. 2차 단서 공개</div>
                                        <p class="stage-tracker__desc">새로운 증거 확인 및 정리</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="discussion_b">
                                        <div class="stage-tracker__label">5. 2차 토론</div>
                                        <p class="stage-tracker__desc">의심 대상 압축 및 검증</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="clue_c">
                                        <div class="stage-tracker__label">6. 3차 단서 공개</div>
                                        <p class="stage-tracker__desc">결정적인 실마리를 확보</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="final_discussion">
                                        <div class="stage-tracker__label">7. 최종 토론</div>
                                        <p class="stage-tracker__desc">최종 가설을 정리하며 토론</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="voting">
                                        <div class="stage-tracker__label">8. 최후 투표</div>
                                        <p class="stage-tracker__desc">범인을 지목하고 투표</p>
                                    </li>
                                    <li class="stage-tracker__item" data-stage="result">
                                        <div class="stage-tracker__label">9. 결과 발표</div>
                                        <p class="stage-tracker__desc">승패 확정 및 요약</p>
                                    </li>
                                </ol>
                            </div>
                            <div class="stage-timer" id="stageTimerDisplay" aria-live="polite">
                                <span class="stage-timer__label">자동 진행</span>
                                <span class="stage-timer__time">대기 중</span>
                            </div>
                        </article>
                    </div>
                    <div class="panel__column panel__column--wide">
                        <article class="card">
                            <div class="card__header-row">
                                <h3 class="card__title">참가자 현황</h3>
                                <div class="player-stats" id="playerStats"></div>
                            </div>
                            <div class="card__actions card__actions--compact">
                                <button id="copyPlayerLink" class="btn btn--ghost">플레이어 링크 복사</button>
                                <button id="addBotBtn" class="btn btn--ghost">봇 추가</button>
                                <button id="assignRolesBtn" class="btn btn--ghost">랜덤 역할 재배정</button>
                            </div>
                            <div class="player-table-wrapper">
                                <table class="player-table" aria-live="polite">
                                    <thead>
                                        <tr>
                                            <th scope="col">닉네임</th>
                                            <th scope="col">상태</th>
                                            <th scope="col">준비</th>
                                            <th scope="col">구분</th>
                                        </tr>
                                    </thead>
                                    <tbody id="playerTableBody">
                                        <tr>
                                            <td colspan="4" class="empty">플레이어가 입장하면 자동으로 목록이 채워집니다.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p class="helper-text">플레이어는 세션 코드와 닉네임만으로 직접 입장합니다. 링크를 공유하여 참가를 안내하세요.</p>
                        </article>
                    </div>
                </div>
            </section>

            <section id="gameView" class="app-view" aria-labelledby="gameTitle">
                <header class="view-header">
                    <div>
                        <h2 id="gameTitle" class="view-header__title">게임 진행</h2>
                        <p class="view-header__subtitle">버튼으로 원하는 탭을 전환하며 진행 현황, 단서, 채팅을 확인하세요.</p>
                    </div>
                    <div class="view-header__actions">
                        <span class="badge" id="gameSessionStatus">-</span>
                        <div class="ready-control" id="hostReadyToolbar">
                            <span id="hostReadyStatus" class="badge">투표 대기</span>
                            <button type="button" id="hostReadyToggleBtn" class="btn btn--secondary">턴 끝내기</button>
                        </div>
                    </div>
                </header>

                <div class="tab-nav" role="tablist">
                    <button class="tab-nav__btn tab-nav__btn--active" data-tab="progress" type="button">진행 현황</button>
                    <button class="tab-nav__btn" data-tab="clues" type="button">내 단서</button>
                    <button class="tab-nav__btn" data-tab="profile" type="button">내 정보</button>
                    <button class="tab-nav__btn" data-tab="scenario" type="button">사건 정보</button>
                    <button class="tab-nav__btn" data-tab="chat" type="button">채팅</button>
                    <button class="tab-nav__btn" data-tab="vote" type="button">투표</button>
                    <button class="tab-nav__btn" data-tab="control" type="button">호스트 제어</button>
                </div>

                <div class="tab-panels">
                    <section class="tab-panel tab-panel--active" data-tab="progress">
                        <article class="card card--stacked">
                            <div class="card__header-row">
                                <h3 class="card__title">진행 단계</h3>
                                <span class="badge" id="progressStageBadge">-</span>
                            </div>
                            <div class="stage-tracker__wrapper stage-tracker__wrapper--compact">
                                <ol class="stage-tracker stage-tracker--compact" aria-label="진행 단계 요약">
                                    <!-- stageTracker is reused via cloning in JS -->
                                </ol>
                            </div>
                            <div class="stage-timer stage-timer--inline" id="gameStageTimer" aria-live="polite">
                                <span class="stage-timer__label">자동 진행</span>
                                <span class="stage-timer__time">-</span>
                            </div>
                            <div class="session-meta session-meta--grid" id="gameMeta"></div>
                            <div class="vote-status" id="voteStatus"></div>
                            <div class="result-banner" id="resultBanner"></div>
                        </article>
                        <article class="card">
                            <h3 class="card__title">준비 현황</h3>
                            <p class="helper-text">준비 현황은 참가자들의 공개 동의만 집계되며, 개인 단서는 누구도 열람할 수 없습니다.</p>
                            <div class="vote-status" id="gameReadyStatus"></div>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="clues">
                        <article class="card card--accent">
                            <h3 class="card__title">내 역할 & 단서</h3>
                            <div class="role-view" id="hostRoleView">
                                <p class="placeholder">게임 시작 후 역할과 단서가 표시됩니다.</p>
                            </div>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="profile">
                        <article class="card card--accent">
                            <h3 class="card__title">내 정보</h3>
                            <p id="hostProfileNotice" class="helper-text">역할이 확정되면 개인 정보가 표시됩니다.</p>
                        </article>
                        <article class="card">
                            <h3 class="card__title">내 역할 타임라인</h3>
                            <ul id="hostProfileTimeline" class="list-number"></ul>
                        </article>
                        <article class="card">
                            <h3 class="card__title">나에 대한 증거 정황</h3>
                            <ul id="hostProfileEvidence" class="list-bullet"></ul>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="scenario">
                        <article class="card">
                            <h3 class="card__title" id="gameScenarioTitle">사건 정보</h3>
                            <p id="gameScenarioTagline" class="helper-text"></p>
                            <p id="gameScenarioSummary"></p>
                        </article>
                        <article class="card">
                            <h3 class="card__title">타임라인</h3>
                            <p class="helper-text">시간 기반 추리가 필요한 경우에만 표시됩니다.</p>
                            <ul class="timeline" id="gameScenarioTimeline"></ul>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="chat">
                        <article class="card">
                            <h3 class="card__title">실시간 채팅</h3>
                            <div class="chat-board" id="chatBoard">
                                <div class="chat-board__main">
                                    <div class="chat-status" id="chatStatus">세션에 접속하면 채팅이 활성화됩니다.</div>
                                    <div class="chat-log" id="chatLog" aria-live="polite"></div>
                                    <form id="chatForm" class="chat-form">
                                        <input type="text" id="chatMessage" class="field__input" placeholder="메시지를 입력하세요" autocomplete="off" disabled>
                                        <button type="submit" class="btn btn--primary" disabled>전송</button>
                                    </form>
                                </div>
                            </div>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="vote">
                        <article class="card">
                            <h3 class="card__title">최후 투표</h3>
                            <form id="hostVoteForm" class="form">
                                <label class="field">
                                    <span class="field__label">범인이라고 생각하는 사람</span>
                                    <select id="hostVoteTarget" class="field__select" disabled></select>
                                </label>
                                <button type="submit" class="btn btn--primary" disabled>투표 제출</button>
                            </form>
                            <p class="helper-text" id="hostVoteHelper">투표가 시작되면 선택지가 활성화됩니다.</p>
                            <div class="vote-result" id="hostVoteStatus"></div>
                        </article>
                    </section>

                    <section class="tab-panel" data-tab="control">
                        <article class="card">
                            <h3 class="card__title">단계 제어</h3>
                            <div class="form-grid">
                                <label class="field">
                                    <span class="field__label">현재 단계</span>
                                    <select id="stageSelect" class="field__select">
                                        <option value="lobby">대기실</option>
                                        <option value="briefing">브리핑</option>
                                        <option value="clue_a">1차 단서 공개</option>
                                        <option value="discussion_a">1차 토론</option>
                                        <option value="clue_b">2차 단서 공개</option>
                                        <option value="discussion_b">2차 토론</option>
                                        <option value="clue_c">3차 단서 공개</option>
                                        <option value="final_discussion">최종 토론</option>
                                        <option value="voting">최후 투표</option>
                                        <option value="result">결과 발표</option>
                                    </select>
                                </label>
                                <button id="updateStageBtn" class="btn btn--ghost">단계 업데이트</button>
                            </div>
                            <div class="card__actions card__actions--stack">
                                <button id="beginVotingBtn" class="btn btn--secondary">최후 투표 시작</button>
                                <button id="closeVotingBtn" class="btn btn--ghost">투표 종료 및 결과 발표</button>
                                <button id="endSessionBtn" class="btn btn--danger" type="button">게임 중단</button>
                            </div>
                            <p class="helper-text">단계 변경은 모든 플레이어 화면에 즉시 반영되며, 자동 타이머가 설정된 단계는 완료 시 차기 단계로 전환됩니다. 게임 중단 버튼을 누르면 즉시 결과 화면으로 이동하며 세션이 종료됩니다.</p>
                        </article>
                    </section>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer__content">
                <p class="footer__title">크라임씬 호스트 콘솔</p>
                <p>세션 생성부터 역할 배정, 채팅 관리까지 한 곳에서 운영하세요.</p>
                <small>배포는 Publish 탭을 이용하세요.</small>
            </div>
        </footer>
    </div>

    <dialog id="toast" class="toast" aria-live="assertive"></dialog>
    <script src="js/host.js" type="module"></script>
</body>
</html>
